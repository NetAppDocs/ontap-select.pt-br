---
sidebar: sidebar 
permalink: concept_stor_vsan_external.html 
keywords: ontap select, vsan and external array configurations, vnas architecture 
summary: 'As implantações do Virtual NAS (vNAS) oferecem suporte a clusters ONTAP Select no vSAN, alguns produtos HCI, tecnologia NetApp HCI e tipos de array externo de armazenamentos de dados. A infraestrutura subjacente dessas configurações proporciona resiliência ao datastore.' 
---
= ONTAP Select vSAN e configurações de array externo
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
As implantações de NAS virtual (vNAS) oferecem suporte a clusters ONTAP Select em SAN virtual (vSAN), alguns produtos HCI e tipos de matriz externa de armazenamentos de dados. A infraestrutura subjacente dessas configurações proporciona resiliência ao datastore.

O requisito mínimo é que o hipervisor que você está usando (VMware ESXi ou KVM em um host Linux compatível) suporte a configuração subjacente.  Se o hipervisor for ESXi, ele deverá ser listado nas respectivas HCLs do VMware.



== Arquitetura vNAS

A nomenclatura vNAS é usada para todas as configurações que não utilizam DAS. Para clusters ONTAP Select com múltiplos nós, isso inclui arquiteturas nas quais os dois nós ONTAP Select no mesmo par de HA compartilham um único datastore (incluindo datastores vSAN). Os nós também podem ser instalados em datastores separados do mesmo array externo compartilhado. Isso permite que as eficiências de storage no lado do array reduzam a área ocupada total do par de HA ONTAP Select. A arquitetura das soluções ONTAP Select vNAS é muito semelhante à do ONTAP Select em DAS com um controlador RAID local. Ou seja, cada nó ONTAP Select continua a ter uma cópia dos dados de seu parceiro de HA. As políticas de eficiência de storage do ONTAP têm escopo de nó. Portanto, as eficiências de storage no lado do array são preferíveis porque podem, potencialmente, ser aplicadas a conjuntos de dados de ambos os nós ONTAP Select.

Também é possível que cada nó ONTAP Select em um par de HA use um array externo separado. Essa é uma escolha comum ao usar o SDS do ONTAP Select MetroCluster com storage externo.

Ao usar arrays externos separados para cada nó do ONTAP Select, é muito importante que os dois arrays forneçam características de desempenho semelhantes à VM do ONTAP Select.



=== Arquiteturas vNAS versus DAS locais com controladores RAID de hardware

A arquitetura vNAS é logicamente mais semelhante à arquitetura de um servidor com DAS e um controlador RAID. Em ambos os casos, o ONTAP Select consome espaço de armazenamento de dados. Esse espaço de armazenamento de dados é esculpido em VMDKs, e essas VMDKs formam os agregados de dados tradicionais do ONTAP. O ONTAP Deploy garante que as VMDKs sejam dimensionadas corretamente e atribuídas à Plex correta (no caso de pares de HA) durante as operações de criação e adição de storage de cluster.

Há duas grandes diferenças entre vNAS e DAS com uma controladora RAID. A diferença mais imediata é que o vNAS não requer uma controladora RAID. O vNAS assume que o array externo subjacente fornece a persistência e resiliência de dados que um DAS com uma configuração de controladora RAID forneceria. A segunda e mais sutil diferença tem a ver com o desempenho do NVRAM.



== VNAS NVRAM

A NVRAM do ONTAP Select é um VMDK. Isso significa que o ONTAP Select emula um espaço endereçável de bytes ( NVRAM tradicional) sobre um dispositivo endereçável de bloco (VMDK). No entanto, o desempenho da NVRAM é absolutamente crítico para o desempenho geral do nó ONTAP Select .

Para configurações de DAS com um controlador RAID de hardware, o cache do controlador RAID de hardware atua como o cache NVRAM , porque todas as gravações no NVRAM VMDK são primeiro hospedadas no cache do controlador RAID.

Para arquiteturas VNAS, o ONTAP Deploy configura automaticamente nós ONTAP Select com um argumento de inicialização chamado Registro de dados de instância única (SIDL). Quando esse argumento de inicialização está presente, o ONTAP Select ignora o NVRAM e grava o payload de dados diretamente no agregado de dados. O NVRAM é usado somente para Registrar o endereço dos blocos alterados pela OPERAÇÃO DE GRAVAÇÃO. O benefício desse recurso é que ele evita uma gravação dupla: Uma gravação para NVRAM e uma segunda gravação quando o NVRAM é destagido. Esse recurso só está habilitado para vNAS porque as gravações locais no cache da controladora RAID têm uma latência adicional insignificante.

O recurso SIDL não é compatível com todos os recursos de eficiência de storage da ONTAP Select. O recurso SIDL pode ser desativado no nível agregado usando o seguinte comando:

[listing]
----
storage aggregate modify -aggregate aggr-name -single-instance-data-logging off
----

NOTE: O desempenho de gravação é afetado se o recurso SIDL estiver desativado. É possível reativar o recurso SIDL depois que todas as políticas de eficiência de storage em todos os volumes desse agregado forem desativadas:

[listing]
----
volume efficiency stop -all true -vserver * -volume * (all volumes in the affected aggregate)
----


== Collocate os nós do ONTAP Select ao usar o vNAS no ESXi

ONTAP Select inclui suporte para clusters ONTAP Select com vários nós em storage compartilhado. ONTAP Deploy permite a configuração de vários nós ONTAP Select no mesmo host ESXi, desde que esses nós não façam parte do mesmo cluster.


NOTE: Essa configuração é válida apenas para ambientes VNAS (storage compartilhado). Instâncias múltiplas do ONTAP Select por host não são suportadas ao usar storage DAS, pois essas instâncias competem pelo mesmo controlador RAID.

ONTAP Deploy garante que a implantação inicial do cluster VNAS de vários nós não coloque várias instâncias do ONTAP Select do mesmo cluster no mesmo host. A figura a seguir ilustra um exemplo de implantação correta de dois clusters de quatro nós que se intercruzam em dois hosts.

*Implantação inicial de clusters VNAS multinó*

image:ST_14.jpg["Implantação inicial de clusters VNAS multinós"]

Após a implantação, os nós do ONTAP Select podem ser migrados entre hosts. Isso pode resultar em configurações não ideais e não suportadas para as quais dois ou mais nós de ONTAP Select do mesmo cluster compartilham o mesmo host subjacente. A NetApp recomenda a criação manual de regras de antiafinidade de VM para que o VMware mantenha automaticamente a separação física entre os nós do mesmo cluster, e não apenas os nós do mesmo par de HA.


NOTE: As regras de antiafinidade exigem que o DRS esteja habilitado no cluster ESXi.

Veja o exemplo a seguir sobre como criar uma regra de anti-afinidade para as VMs ONTAP Select. Se o cluster do ONTAP Select contiver mais de um par de HA, todos os nós do cluster precisarão ser incluídos nesta regra.

image:ST_15.jpg["Regras de VM/host"]

image:ST_16.jpg["Editar regra VM/Host"]

Dois ou mais nós ONTAP Select do mesmo cluster ONTAP Select podem ser encontrados no mesmo host ESXi por um dos seguintes motivos:

* O DRS não está presente devido a limitações de licença do VMware vSphere ou se o DRS não estiver habilitado.
* A regra de anti-afinidade DRS é ignorada porque uma operação VMware HA ou migração de VM iniciada pelo administrador tem precedência.



NOTE: ONTAP Deploy não monitora proativamente os locais das VMs do ONTAP Select. No entanto, uma operação de atualização do cluster reflete essa configuração não suportada nos logs do ONTAP Deploy:

image:ST_17.PNG["Logs de implantação do ONTAP"]
